<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vedic Forensic Engine - Pro</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>
</head>
<body>

<div class="container main-dashboard">
    <header class="app-header">
        <h1>Jyotish BTR Forensic Engine</h1>
        <p>Parashara (D60) â€¢ Jaimini (Vighatika) â€¢ Tattwa (Kunda)</p>
        <button class="theme-toggle" onclick="app.toggleTheme()" title="Toggle Dark Mode">ðŸŒ“</button>
    </header>

    <section class="panel control-deck">
        <div class="deck-header">
            <div class="mode-tabs">
                <button class="mode-tab active" onclick="app.ui.switchTab('standard')">Standard BTR</button>
                <button class="mode-tab" onclick="app.ui.switchTab('jaimini')">Jaimini Authentic</button>
            </div>
            <div class="toolbar">
                <button onclick="app.loadSample('m')" class="btn-tool">ðŸ“¥ Load Sample</button>
                <button onclick="app.clearData('m')" class="btn-tool">ðŸ§¹ Clear</button>
            </div>
        </div>
        
        <div id="tab_standard" class="tab-content-area">
            <div class="input-grid">
                
                <div class="input-group-box">
                    <label class="group-label">1. Identity</label>
                    <div class="row">
                        <select id="m_gender" style="flex: 0 0 100px;">
                            <option value="MALE">Male</option>
                            <option value="FEMALE">Female</option>
                        </select>
                        <input type="text" id="m_name" placeholder="Name" oninput="app.updateLiveSound('m')" onchange="app.calculate('m')">
                    </div>
                </div>

                <div class="input-group-box">
                    <label class="group-label">2. Birth Location</label>
                    <div style="position:relative; width:100%;">
                        <input type="text" id="m_city" placeholder="ðŸ” Search City (e.g. New York)..." 
                               autocomplete="off" oninput="app.ui.handleSearchDebounced('m')"
                               style="font-weight:bold;">
                        <div id="m_city_results" class="results-dropdown"></div>
                    </div>
                    <div class="row" style="margin-top:5px;">
                        <input type="text" id="m_lat" placeholder="Lat" readonly style="background:var(--hover-bg); color:var(--text-muted); font-size:0.7rem;">
                        <input type="text" id="m_lon" placeholder="Lon" readonly style="background:var(--hover-bg); color:var(--text-muted); font-size:0.7rem;">
                    </div>
                </div>

                <div class="input-group-box">
                    <label class="group-label">3. Time & Zone</label>
                    <div class="row">
                        <input type="date" id="m_dob" onchange="app.ui.updateTzFromDate('m')">
                        <input type="time" id="m_tob" step="1">
                    </div>
                    <div class="row" style="margin-top:5px; align-items: center;">
                        <div style="flex:1; display:flex; flex-direction:column;">
                             <label style="font-size:0.6rem; color:var(--text-muted);">Time Zone (Auto)</label>
                             <input type="number" id="m_tz" placeholder="Offset" onchange="app.calculate('m')" step="0.25">
                        </div>
                        <div style="flex:1; text-align:right;">
                             <span id="m_utc_hint" style="font-size:0.75rem; color:var(--primary); font-weight:bold;">--:-- Z</span>
                             <div style="font-size:0.6rem; color:var(--text-muted);" id="m_tz_name">Unknown Zone</div>
                        </div>
                    </div>
                </div>

                <div class="input-group-box">
                    <label class="group-label">4. Forensic Keys</label>
                    <div class="live-status-bar">
                        <div class="status-badge">
                            <span class="status-label">SOUND</span>
                            <span id="m_feedback_sound" class="status-value">--</span>
                        </div>
                        <div class="status-badge">
                            <span class="status-label">ARUDHA</span>
                            <span id="m_feedback_arudha" class="status-value">--</span>
                        </div>
                    </div>
                    <div class="stepper-row" style="margin-top:5px;">
                        <button onclick="app.adjustTime('m', -10)">-10s</button>
                        <button onclick="app.adjustTime('m', -1)">-1s</button>
                        <button onclick="app.adjustTime('m', 1)">+1s</button>
                        <button onclick="app.adjustTime('m', 10)">+10s</button>
                    </div>
                </div>

                <div class="input-group-box action-box" style="grid-column: 1 / -1;">
                    <div class="row">
                        <button onclick="app.autoFixPranapada('m')" class="btn-tool" style="background: var(--text-main);">ðŸŽ¯ Auto-Fix D9</button>
                        <button onclick="app.scan20MinWindow('m')" class="btn-scan">Scan Â±10m</button>
                        <button onclick="app.calculate('m')" class="btn-run" style="flex:2;">RUN ENGINE</button>
                    </div>
                </div>

                <select id="m_sound" style="display:none;"><option value="AUTO">Auto</option></select>
                <select id="m_arudha" style="display:none;"><option value="AUTO">Auto</option></select>
            </div>
        </div>

        <div id="tab_jaimini" class="tab-content-area" style="display:none;">
            <div class="input-grid">
                <div class="input-group-box">
                    <label class="group-label">Vighatika Engine</label>
                    <div class="row">
                        <input type="text" id="m_sunrise_display" readonly placeholder="Sunrise">
                        <input type="text" id="m_vig_display" readonly placeholder="VG Planet">
                    </div>
                </div>
                 <div class="input-group-box">
                    <label class="group-label">Jaimini Gender Test</label>
                    <div class="row">
                        <select id="m_vig_state">
                            <option value="normal">State: Normal</option>
                            <option value="exalted">State: Exalted</option>
                            <option value="debilitated">State: Debilitated</option>
                        </select>
                        <button onclick="app.runJaiminiSexCheck('m')" class="btn-tool">Check</button>
                    </div>
                    <div id="m_sex_result" class="result-box-sm" style="display:none;"></div>
                </div>
                <div class="input-group-box action-box">
                    <div class="table-scroll" style="max-height:120px;">
                        <table class="planet-table">
                            <thead><tr><th>Adj</th><th>Time</th><th>Planet</th><th>Gen</th></tr></thead>
                            <tbody id="m_jaimini_rect_body"></tbody>
                        </table>
                    </div>
                    <button onclick="app.runJaiminiRect('m')" class="btn-scan">Micro-Scan</button>
                </div>
            </div>
        </div>

    </section>

    <section class="panel timeline-container" id="forensic_map_panel" style="display:none;">
        <div class="timeline-header">
            <span>Forensic Timeline</span>
            <span>Quad-Lock System</span>
        </div>
        <div style="padding-left:80px;">
            <div class="timeline-tracks" id="timeline_tracks"></div>
        </div>
    </section>

    <section id="visual_lab_section" class="panel forensic-lab-container">
        <div class="chart-viewer">
            <div class="panel-head">
                <span>Visual Verification</span>
                <select id="chart1_varga" onchange="app.refreshCharts()" class="chart-select">
                    <option value="D60">Shashtiamsha (D60)</option>
                    <option value="D9">Navamsa (D9)</option>
                    <option value="D1">Rashi (D1)</option>
                </select>
            </div>
            <div id="si_chart1" class="si-container"></div>
            
            <div style="margin-top:15px; border-top:1px solid var(--border); padding-top:10px;">
                 <div class="panel-head">
                    <span style="font-size:0.7rem;">Secondary View</span>
                    <select id="chart2_varga" onchange="app.refreshCharts()" class="chart-select">
                        <option value="D9">Navamsa (D9)</option>
                        <option value="D1">Rashi (D1)</option>
                    </select>
                </div>
                <div id="si_chart2" class="si-container" style="width: 200px; height: 200px; font-size:0.6rem;"></div>
            </div>
            
            <button onclick="document.getElementById('planet_data_panel').style.display = document.getElementById('planet_data_panel').style.display === 'none' ? 'block' : 'none'" class="btn-tool" style="margin-top:10px; width:100%;">Show Data Table</button>
            <div id="planet_data_panel" class="table-scroll" style="display:none; max-height:200px;">
                <table class="planet-table"><tbody id="m_table_body"></tbody></table>
            </div>
        </div>

        <div class="auditor-wrapper">
            <div id="m_suggestion" class="candidates-container" style="display:none;"></div>
            <div id="m_analysis">
                <div style="padding:40px; text-align:center; color:var(--text-muted);">
                    Run the engine to start verification.
                </div>
            </div>
            <div id="m_scan_results" class="scan-box" style="display:none;">
                <label class="group-label">Scan Results</label>
                <div class="table-scroll" style="max-height: 200px;">
                    <table class="planet-table"><tbody id="m_scan_body"></tbody></table>
                </div>
            </div>
            <div id="m_logic_trace" class="trace-log" style="display:none;"></div>
        </div>
    </section>

</div>

<script src="js/constants.js"></script>
<script src="js/astronomy-wrapper.js"></script>
<script src="js/vedic-engine.js"></script>
<script src="js/rectification-analyzer.js"></script>
<script src="js/jaimini-engine.js"></script>
<script src="js/tattwa-engine.js"></script>
<script src="js/app.js"></script>
</body>
</html>
